---
layout: post
title:  "《LoRaWAN规范》第1-2章"
date:   2018-03-13 10:45:13 +0800
background: '/img/posts/06.jpg'
---

### 1 介绍
本文档对LoRaWAN网络协议进行说明，这是套针对电池供电的终端设备进行了优化的网络协议。

LoRaWAN网络架构是一个典型的星型拓扑结构，其中网关作为透明中继，连接前端的终端设备和后端的中央服务器。网关与服务器通过标准IP连接，而终端设备与一个或多个网关通过单跳LoRa或是FSK调制方式通信。所有通信通常均为双向进行，不过还是以终端往服务器的上行链路为主要业务。

终端与网关之间的通信基于不同的频率和数据传输速率完成。数据传输速率的选择需要权衡传输距离和消息时延两个因素，不同数据传输速率通信不会互相干扰。LoRa数据传输速率范围为0.3 kbps至50 kbps，为了最大化终端设备电池寿命和整个网络容量，LoRa网络结构通过一种速率自适应（ADR）方法来单独管理每个终端的数据传输速率和射频输出。

只要满足以下规则，终端设备就可在任意时间，以任意可用信道和数据传输速率进行传输：
- 终端设备每次传输均以一种伪随机方式改变信道，由此导致的频率多样性使得系统抗干扰性更强；
- 终端设备需遵守相应频段和本地区规定的发射占空比要求；
- 终端设备需遵守相应频段和本地区规定的发射时长要求。

> 注意：各频段和地区规定的最大发射占空比和时长定义见第6章。


#### 1.1 LoRaWAN Classes
所有LoRaWAN设备都必须至少实现本文档描述的Class A功能。同时本文档描述的Class B、Class C或后续定义功能则为可选功能，但无论如何，设备均需兼容Class A。

#### 1.2 约定
MAC命令的格式为**_LinkCheckReq_**，bits和bit域的格式为**FRMPayload**，常量格式为RECEIVE_DELAY1，变量格式为*N*。

在本文档中，
- 所有多字节字段采用小端字节序；
- EUI为64位整数，采用小端模式传输。

### 2 LoRaWAN种类介绍
LoRa是Semtech公司为远距离低功耗低速率应用开发的一种无线调制技术。本文档将实现比Class A更多功能的设备统称为“高类终端设备”。

#### 2.1 LoRaWAN Classes
一个LoRa网络包括基础LoRaWAN（称为Class A）和可选特性（Class B,Class C...）：
<img src="https://raw.githubusercontent.com/qigeloveit/LoRaWAN_Specification_Learning/master/image/lorawan_classes.png" width="900" alt="lorawan classes"/>
<center>图1 LoRaWAN Classes</center>

- **双向传输终端（Class A）**：Class A 终端在每个上行链路后会有两个短暂的下行接收窗口，以此实现双工通信。传输时隙由终端根据自身通信需求规划，并附加一点随机延时（ALOHA协议）。对于那些只需要在发送数据之后短时间内接收服务器数据的应用而言，Class A 是功耗最低的终端系统。服务器在其它时间内的下行数据要等到下一次上行链路之后才能发送。
- **规划接收时隙的双向传输终端（Class B）**：Class B 终端允许更多接收时隙。在Class A 的随机接收窗口之上，Class B 设备会定时开启额外接收窗口。为了使终端设备能在指定时间开启接收窗口，终端设备需从网关那里获取时间同步信标Beacon。这样服务器就能知道终端设备何时处于监听状态。
- **拥有最大接收时隙的双向传输终端（Class C）**：Class C 终端几乎一直开着接收窗口，只有当发送时才会暂时关闭。Class C 终端要比 Class A 和 Class B
更为耗电，但从服务器传输至终端的时延却是最短的。

#### 2.2 范围
本篇LoRaWAN规范描述了高类终端设备与Class A 终端设备功能的不同之处。高类终端设备必须满足Class A 定义的所有功能。

>  注意：为避免重复，物理层消息格式、MAC消息格式以及其余规范中几类终端共同部分内容将只在Class A 部分进行描述。

